<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizar Produto</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <nav class="navbar">
        <ul>
            <li><a href="index.html">Cadastrar Produto</a></li>
            <li><a href="procurarProduto.html">Procurar Produto</a></li>
            <li><a href="apagarProduto.html">Apagar Produto</a></li>
            <li><a href="atualizarProduto.html" class="active">Atualizar Produto</a></li>
             <li><a href="procurar.html">Busca Filtro</a></li>
              <li><a href="procuraValor.html" >Produto Menor</a></li>
        </ul>
    </nav>
</header>

<div class="container" id="atualizarProduto">
    <h2>Atualizar Produto</h2>
    <form id="formAtualizar" method="POST">
        <div class="input-box">
            <input type="number" id="idProduto" placeholder="* ID do Produto" required>
            <button type="button" onclick="carregarProduto()">Buscar</button>
        </div>

        <div class="input-box">
            <input type="text" id="descricao" placeholder="Descrição do Produto" required>
        </div>

        <div class="input-box">
            <input type="date" id="dtvalidade" placeholder="Data de Validade" required>
        </div>

        <div class="input-box">
            <input type="number" id="valor" step="0.01" placeholder="Valor Unitário (R$)" required>
        </div>

        <div class="input-box">
            <input type="number" id="categoria" placeholder="* Código da Categoria" required>
        </div>
    </form>

    <button onclick="atualizarProduto()">Atualizar</button>
    <p id="mensagem"></p>
</div>

<script>
function carregarProduto() {
    const id = document.getElementById("idProduto").value;
    fetch(`http://localhost:8080/apis/produto/${id}`)
        .then(res => {
            if (!res.ok) throw new Error("Produto não encontrado.");
            return res.json();
        })
        .then(produto => {
            document.getElementById("descricao").value = produto.nome;
            document.getElementById("dtvalidade").value = produto.data;
            document.getElementById("valor").value = produto.preco;
            document.getElementById("categoria").value = produto.categoria.id;
            document.getElementById("mensagem").textContent = "Produto carregado.";
        })
        .catch(err => {
            document.getElementById("mensagem").textContent = err.message;
        });
}

function atualizarProduto() {
    let formData = new FormData();
    let id = document.getElementById("idProduto").value;
    let desc = document.getElementById("descricao").value;
    let validade = document.getElementById("dtvalidade").value;
    let valor = document.getElementById("valor").value;
    let categoria = document.getElementById("categoria").value;

    formData.append("prod_cod", id);
    formData.append("prod_desc", desc);
    formData.append("prod_dtvalid", validade);
    formData.append("prod_valorun", valor);
    formData.append("categoria", categoria);

    fetch("http://localhost:8080/apis/produto", {
        method: "PUT",
        body: formData
    })
    .then(res => {
        if (!res.ok) return res.text().then(text => { throw new Error(text); });
        return res.json();
    })
    .then(json => {
        document.getElementById("mensagem").textContent = json.mensagem;
        document.getElementById("formAtualizar").reset();
    })
    .catch(error => {
        console.error("Erro:", error);
        document.getElementById("mensagem").textContent = "Erro ao atualizar produto.";
    });
}
</script>
</body>
</html>
